language: python

matrix:
  include:
    - name: "Python 3.7 on Xenial Linux"
      python: 3.7
      env: PYTHON_VER=2.7
    - name: "Python 2.7 on Xenial Linux"
      python: 2.7.16
      env: PYTHON_VER=2.6

#python: 
# - "3.7.4"

#before_install:
# - git clone https://github.com/TravisToolbox/pycodestyle-travis.git

install:
 - pip install -r requirements.txt
 - pip install -r test_requirements.txt
# - ./pycodestyle-travis/install.sh


script:
 - export VERSION=$(git describe --tags --abbrev=1 | sed -E 's|-(.*)-.*|.\1|g')
 - echo "__version__ = \"$VERSION\"" > rfapi/_version.py
 #- ./pycodestyle-travis/scan.sh
 # Run pylint, terminate if it has any errors
 #- pylint -E rfapi
 # - (($RUNPYLINT == true && pylint -E rfapi) || ($RUNPYLINT == false)) || travis_terminate 1
 # Run Tests on both python2 & 3
 - (python3 -m nose --with-doctest rfapi || python2 -m nose --with-doctest rfapi) || travis_terminate 1

before_deploy:
 - export VERSION=$(git describe --tags --abbrev=1 | sed -E 's|-(.*)-.*|.\1|g')
 - echo "__version__ = \"$VERSION\"" > rfapi/_version.py

deploy:
# - provider: pypi
#   user: __token__
#   password: $PYPI_TOKEN
#   server: https://test.pypi.org/legacy/
#   distributions: "sdist bdist_wheel"
#   skip_cleanup: true
#   on:
#     condition: $PYTHON_VER = 2.7
#     branch: master
#     tags: true
  - provider: releases
      api_key: "$GITHUB_OAUTH_TOKEN"
      file: "dist/rfapi-$VERSION.tar.gz"
      skip_cleanup: true
      on:
        tags: true
        condition: $PYTHON_VER = 2.7
